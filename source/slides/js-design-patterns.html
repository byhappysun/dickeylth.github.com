---
layout: false
---

<!DOCTYPE html>
<html>
<head>
    <title>JavaScript设计模式</title>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" href="css/reveal.min.css"/>
    <link rel="stylesheet" href="css/theme-sky.css"/>
    <link rel="stylesheet" href="css/zenburn.css"/>
</head>
<body>

    <div class="reveal">
        <div class="slides">

            <section>
                <h2>JavaScript设计模式</h2>
                <div>
                    <p>弘树</p>
                    <time>2013年11月21日</time>
                </div>
            </section>

            <section>
                <h3>目录</h3>
                <ul>
                    <li>设计模式认识</li>
                    <li>单例模式</li>
                    <li>工厂模式</li>
                    <li>装饰者模式</li>
                    <li>策略模式</li>
                    <li>观察者模式</li>
                    <li>回顾</li>
                </ul>
            </section>

            <section class="overall">

                <section>
                    <h3>设计模式</h3>
                    <blockquote>源于生活，高于生活。</blockquote>
                </section>

                <section>
                    <a href="#" class="image navigate-down">
                        <img src="img/slide1.jpg"/>
                    </a>
                </section>

                <section>
                    <a href="#" class="image">
                        <img src="img/slide2.jpg"/>
                    </a>
                </section>

                <section>
                    <p class="fragment">
                        <h3>关键词：</h3>
                        <ul>
                            <li class="fragment">模块内聚性</li>
                            <li class="fragment">模块间解耦</li>
                            <li class="fragment">可扩展性</li>
                            <li class="fragment">支撑业务复杂性的增长</li>
                        </ul>
                    </p>
                </section>

            </section>

            <section class="singleton">

                <section>
                    <h3>单例模式</h3>
                    <p class="fragment">
                        <a href="" class="image">
                            <img src="img/singleton0.png"/>
                        </a>
                    </p>
                </section>

                <section>
                    <p class="fragment">
                        <h4>主要特点</h4>
                        <ul>
                            <li class="fragment">单个实例</li>
                            <li class="fragment">初始化</li>
                            <li class="fragment">对外提供访问接口</li>
                        </ul>
                    </p>
                </section>

                <section>
                    <p class="fragment">
                        <h4>实现方式</h4>
                        <ul>
                            <li class="fragment">对象字面量</li>
                            <li class="fragment">使用<code>new</code>创建对象</li>
                        </ul>
                    </p>
                </section>

                <section>
                    <h4>对象字面量</h4>
                    <pre class="fragment">
                        <code data-trim contenteditable>
var x = {
    attr: 'value'
};

var y = {
    attr: 'value'
};

x == y;     // false
x === y;    // false
                        </code>
                    </pre>
                </section>

                <section>
                    <h4>加强版</h4>
                    <a class="jsbin-embed" href="http://jsbin.com/eFOHuWuP/1/embed?js,console">JS Bin</a>
                </section>

                <section>
                    <h4>使用<code>new</code>创建对象</h4>
                    <pre class="fragment">
                        <code data-trim contenteditable>
var x = new SuperMario();
var y = new SuperMario();
x == y;     // true
                        </code>
                    </pre>
                    <div class="fragment">
                        <h4>可行的方案：</h4>
                        <ul>
                            <li>类的静态属性</li>
                            <li>闭包</li>
                        </ul>
                    </div>
                </section>

                <section>
                    <h4>类的静态属性</h4>
                    <a class="jsbin-embed" href="http://jsbin.com/adaVOmes/1/embed?js,console">JS Bin</a>
                </section>

                <section>
                    <blockquote>
                        <h4>构造函数的<code>return</code>：</h4>
                        <ol>
                            <li>当 return 一个引用对象（数组、函数、对象等）时，直接覆盖内部的隐式 this 对象，返回值就是该引用对象；</li>
                            <li>当 return 5 种基本类型（undefined、null、Boolean、Number、String）之一时（无 return 时其实就是返回 undefined），返回内部隐式 this 对象。</li>
                        </ol>
                    </blockquote>
                </section>

                <section>
                    <h4>闭包</h4>
                    <a class="jsbin-embed" href="http://jsbin.com/OjiFucu/8/embed?js,console">JS Bin</a>
                </section>

                <section>
                    <h4>闭包带来的问题</h4>
                    <a class="jsbin-embed" href="http://jsbin.com/OjiFucu/9/edit?js,console">JS Bin</a>
                </section>

                <section>
                    <h4>修复办法</h4>
                    <a class="jsbin-embed" href="http://jsbin.com/EBozomU/2/embed?js,console">JS Bin</a>
                </section>

                <section>
                    <h3>开源框架和库</h3>
                    <ul>
                        <li>
                            <a class="fragment">
                                <img src="img/yui.png" alt="YUI" class="image"/>
                            </a>
                        </li>
                        <li>
                            <a class="fragment">
                                <img src="img/kissy.png" alt="YUI" class="image"/>
                            </a>
                        </li>
                        <li>
                            <a class="fragment">
                                <img src="img/jquery.png" alt="YUI" class="image"/>
                            </a>
                        </li>
                        <li>
                            <a class="fragment">
                                <img src="img/underscore.png" alt="YUI" class="image"/>
                            </a>
                        </li>
                    </ul>
                </section>

                <section>
                    <h4>jQuery单例应用</h4>
                    <pre class="fragment">
                        <code data-trim contenteditable>
(function( window, undefined ) {

    var jQuery = (function() {

        // 构建 jQuery 对象
        var jQuery = function( selector, context ) {
            return new jQuery.fn.init( selector, context, rootjQuery );
        }

        // jQuery 对象原型
        jQuery.fn = jQuery.prototype = {
            constructor: jQuery,
            init: function( selector, context, rootjQuery ) {
                // selector 有以下 7 种分支情况：
                // DOM 元素
                // body（优化）
                // 字符串：HTML 标签、HTML 字符串、#id、选择器表达式
                // 函数（作为 ready 回调函数）
                // 最后返回伪数组
            }
        };

        // 猜猜这句是干什么呢？
        jQuery.fn.init.prototype = jQuery.fn;

        // 合并内容到第一个参数中，后续大部分功能都通过该函数扩展
        // 通过 jQuery.fn.extend 扩展的函数，大部分都会调用通过 jQuery.extend 扩展的同名函数
        jQuery.extend = jQuery.fn.extend = function() {};

        // 在 jQuery 上扩展静态方法
        jQuery.extend({
            // ready bindReady
            // isPlainObject isEmptyObject
            // parseJSON parseXML
            // globalEval
            // each makeArray inArray merge grep map
            // proxy
            // access
            // uaMatch
            // sub
            // browser
        });

        // 到这里，jQuery 对象构造完成，后边的代码都是对 jQuery 或 jQuery 对象的扩展
        return jQuery;

    })();

    window.jQuery = window.$ = jQuery;
})(window);
                        </code>
                    </pre>
                </section>

                <section>
                    <h4>KISSY单例应用</h4>
                    <pre class="fragment">
                        <code data-trim contenteditable>
/**
* A seed where KISSY grows up from, KISS Yeah !
*/
var KISSY = (function (undefined) {
    var host = this,
    S,
    guid = 0,
    EMPTY = '';

    var loggerLevel = {
        'debug': 10,
        'info': 20,
        'warn': 30,
        'error': 40
    };

    S = {
        /**
        * The build time of the library.
        __BUILD_TIME: '@TIMESTAMP@',

        /**
        * KISSY Environment.
        */
        Env: {
            host: host
        },

        /**
        * KISSY Config.
        */
        Config: {
            debug: '@DEBUG@',
            fns: {}
        },

        /**
        * The version of the library.
        */
        version: '@VERSION@',

        /**
        * set KISSY configuration
        */
        config: function (configName, configValue) {
            ...
        },

        /**
        * Prints debug info.
        *
        */
        log: function (msg, cat, logger) {
            ...
        },

        /**
        * get log instance for specified logger
        */
        'getLogger': function (logger) {
            return getLogger(logger);
        },

        /**
        * Throws error message.
        */
        error: function (msg) {
            ...
        },

        /*
        * Generate a global unique id.
        */
        guid: function (pre) {
            return (pre || EMPTY) + guid++;
        }
    };

    if ('@DEBUG@') {
        S.Config.logger = {
            excludes: [
                {
                    logger: /^s\/.*/,
                    maxLevel: 'info',
                    minLevel: 'debug'
                }
            ]
        };

        /**
        * Log class for specified logger
        */
        function Logger() {

        }

        /**
        * print debug log
        */
        Logger.prototype.debug = function (str) {
            ...
        };
        ...
    }

    function getLogger(logger) {
        ...
    }


    /**
    * Logger level enum
    */
    S.Logger = /**@type Function
    @ignore */{};
    S.Logger.Level = {
        /**
        * debug level
        */
        'DEBUG': 'debug',
        ...
    };

return S;
})();
                        </code>
                    </pre>
                </section>

            </section>

            <section class="factory">

                <section>
                    <h3>工厂模式</h3>
                    <p class="fragment">
                        <a href="" class="image">
                            <img src="img/factory0.png" alt="工厂模式"/>
                        </a>
                    </p>
                </section>

                <section>
                    <pre>
                        <code data-trim contenteditable>
var o = new Object(),
n = new Object(1),
s = Object('1'),
b = Object(true);

// test
o.constructor === Object;	// true
n.constructor === Number;	// true
s.constructor === String;	// true
b.constructor === Boolean;	// true
                       </code>
                    </pre>
                </section>

                <section>
                    <h4>工厂 vs 构造函数 ？</h4>
                    <pre class="fragment">
                        <code data-trim contenteditable>
var http = require("http");

http.createServer(function(request, response) {
    response.writeHead(200, {"Content-Type": "text/plain"});
    response.write("Hello World");
    response.end();
}).listen(8888);
                        </code>
                    </pre>
                </section>

                <section>
                    <pre class="fragment">
                        <code data-trim contenteditable>
function Server(requestListener) {
    if (!(this instanceof Server)) return new Server(requestListener);
    net.Server.call(this, { allowHalfOpen: true });
    ......
}
util.inherits(Server, net.Server);

exports.Server = Server;

exports.createServer = function(requestListener) {
    return new Server(requestListener);
};
                        </code>
                    </pre>

                    <ul class="fragment">
                        <li><a href="https://groups.google.com/forum/#!msg/nodejs/GTaCdFPlweI/M0q38C3SJpkJ" target="_blank">[nodejs] Why net.createServer() and not new net.Server()?</a></li>
                        <li><a href="https://groups.google.com/forum/#!msg/nodejs/yoXogs7vNYU/uUKT59t_w-sJ" target="_blank">Why export both http.Server() and http.createServer()?</a></li>
                    </ul>
                </section>

                <section>
                    <pre class="fragment">
                        <code data-trim contenteditable>
new Date(2012).toLocaleString();
// "1970 年 1 月 1 日 上午 8:00:02"

new Date(2012, 1).toLocaleString();
// "2012 年 2 月 1 日 上午 12:00:00"

new Date(2012, 1, 1).toLocaleString();
// "2012 年 2 月 1 日 上午 12:00:00"

new Date(2012, 1, 1, 1).toLocaleString();
// "2012 年 2 月 1 日 上午 1:00:00"

new Date(2012, 1, 1, 1, 1).toLocaleString();
// "2012 年 2 月 1 日 上午 1:01:00"

new Date(2012, 1, 1, 1, 1, 1).toLocaleString();
// "2012 年 2 月 1 日 上午 1:01:01"
                        </code>
                    </pre>
                </section>

                <section>
                    <pre class="fragment">
                        <code data-trim contenteditable>
/*
* 解析日期字符串，自动创建对应 Date 对象
* @param String str 日期字符串
* @return Date object
*/
function parseDate(str){

    // native parse, with help from native Date constructor
    var result = new Date(str);

    if(!(result instanceof Date) || isNaN(result.getTime())){

        // split numbers from string
        var timeArr = str.match(/\d+/g);

        // TODO
        var toDate = createDate.apply(null, timeArr);
    }
}
                        </code>
                    </pre>

                    <h4 class="fragment"><em>构造函数并不能直接通过 call 或者 apply 的方式传入参数数组来调用！</em></h4>
                </section>

                <section>
                    <a class="jsbin-embed" href="http://jsbin.com/IyOGuHO/3/embed?js,console">JS Bin</a>
                </section>

            </section>

            <section class="decorator">

                <section>
                    <h3>装饰者模式</h3>
                </section>

            </section>

        </div>
    </div>


    <script src="js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

        // Full list of configuration options available here:
        // https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            center: true,

            theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
            transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

            // Parallax scrolling
            // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
            // parallaxBackgroundSize: '2100px 900px',

            // Optional libraries used to extend on reveal.js
            dependencies: [
                { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                { src: 'js/plugin/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                { src: 'js/plugin/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                { src: 'js/plugin/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                { src: 'js/plugin/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
                { src: 'js/plugin/notes.js', async: true, condition: function() { return !!document.body.classList; } }
            ]
        });
    </script>

    <script src="js/embed.js"></script>
</body>
</html>